<!DOCTYPE html>
<html lang="cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>扫雷</title>
    <style>
        body {
            display: grid;
            background-color: #F0F0F0;
            justify-content: center;
            margin: 0;
            padding: 10px;
        }

       .box {
            display: flex;
            flex-wrap: wrap;
            background-color: #D3D3D3;
            padding: 2px;
            border-radius: 8px;
        }

       .time {
            display: inline-block;
            font-size: 14px;
            margin-bottom: 10px;
        }

       .item {
            border: 1px solid #ddd;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #D3D3D3;
            border-top: 2px solid white;
            border-left: 2px solid white;
            border-right: 2px solid #ccc;
            border-bottom: 2px solid #ccc;
            touch-action: none; /* 禁用默认触摸行为 */
        }

       .circle {
            border: 10px solid #a33939;
            border-radius: 100%;
        }

       .hide {
            display: none;
        }

       .info::after {
            position: relative;
            top: 2px;
            left: 1px;
            content: url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEA8ADwAAD/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAEAAAAAAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAAcABwDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD7grw/4xf8FA/h78LtDv5bDUD4r1K0VtttphDQEqpJ3XB/dgcYJQuQeCBg49k8QaDaeKdBvtMv4vPsdRt5LW4i3MvmRupVlypBGQSMgg18aftc/wDBPzQPhX+z/wCLfF3h/XdSik8MaLe6nfRakI5hcQQQNKQjxxqUZQr8FXDFh93B3eLnNXMIQX1GKffv8l/w/ofqHhdl3BWKxclxfiJ019iMVaEtH8c1eS1tZJR1teVr2+16KKK9o/KzL8b6hquk+C9XutC06DV9btrKaXT7Ga4FtHe3CxsYoWlIPlq7hVL4O0HODivyn/bM/Zs/b2/a/wDGepXcunJ4O8PX9g2lyeHfD/jfyNNurZt4ZZojc7JXdXKOzKAygDaOlfrYDj8ad5jepoGnY/Pr/gm5of7Zn7Ol6nhn4oeEYPHnhjWNVW5n1vVvGy3Oq6KspgjkKs0kvmwRRpJIIFVS0jnDjca/QQHHYUolYd6aTuJJ6mgGz//Z);
            height: 30px;
            width: 30px;
        }

       .message {
            display: inline-block;
            font-size: 14px;
            margin-bottom: 10px;
        }

       .number-1 {
            color: blue;
        }

       .number-2 {
            color: green;
        }

       .number-3 {
            color: red;
        }

       .number-4 {
            color: darkblue;
        }

       .number-5 {
            color: purple;
        }

       .number-6 {
            color: teal;
        }

       .number-7 {
            color: black;
        }

       .number-8 {
            color: gray;
        }
    </style>
</head>

<body>
    <div style="display: flex; justify-content: space-between;">
        <div class="message"></div>
        <div class="time"></div>
    </div>
    <div class="box"></div>
    <script>
        const rows = 10;
        const cols = 10;
        const size = 40;
        const result = [];
        let minesCount = 0;
        const mines = {};
        const Xnum = [];
        const Ynum = [];
        let max = 10;
        let k = 0;
        let i = 0;
        let j = 0;
        let time = 0;
        let time_ = 0;

        // 生成雷区
        while (Ynum.length < max) {
            j = Math.floor(Math.random() * rows);
            k = Math.floor(Math.random() * cols);
            if (!Xnum.includes(j) || !Ynum.includes(k)) {
                Xnum.push(j);
                Ynum.push(k);
            }
        }
        for (i = 0; i < Math.min(Xnum.length, Ynum.length); i++) {
            mines[Xnum[i] + '-' + Ynum[i]] = 1;
        }

        // 计算每个格子的数字
        for (i = 0; i < rows; i++) {
            for (j = 0; j < cols; j++) {
                minesCount += mines[i + '-' + j] || 0;
            }
        }

        // 初始化界面
        const box = document.querySelector('.box');
        const message = document.querySelector('.message');
        message.innerHTML = `地雷：<div class="number-3" style="display: inline-block;">${minesCount}</div>`;
        const timeDiv = document.querySelector('.time');
        timeDiv.innerHTML = `时间：<div class="number-3" style="display: inline-block;">0</div>`;

        // 生成网格
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                const isMines = mines[i + '-' + j];
                const number = Object.values({
                    0: mines[`${i - 1}-${j - 1}`],
                    1: mines[`${i - 1}-${j}`],
                    2: mines[`${i - 1}-${j + 1}`],
                    3: mines[`${i}-${j - 1}`],
                    4: mines[`${i}-${j + 1}`],
                    5: mines[`${i + 1}-${j - 1}`],
                    6: mines[`${i + 1}-${j}`],
                    7: mines[`${i + 1}-${j + 1}`],
                }).filter(v => v).length;
                result.push(`<div class="item hide" data-v="${i}-${j}"
                    style="width:${size}px;height:${size}px"
                >
                ${isMines? `<div class="circle"></div>` : `<div class="number number-${number? number : ''}">${number? number : ''}</div>`}
                </div>`);
            }
        }
        box.style.width = `${cols * size}px`;
        box.style.height = `${rows * size}px`;
        box.innerHTML = result.join('');

        // 初始化时间
        const intervalId = setInterval(() => {
            time_++;
            timeDiv.innerHTML = `时间：<div class="number-3" style="display: inline-block;">${time_}</div>`;
        }, 1000);

        // 触摸事件处理
        box.querySelectorAll('.item').forEach(v => {
            let isLongPress = false;
            let touchStart = 0;

            v.addEventListener('touchstart', (e) => {
                touchStart = Date.now();
            });

            v.addEventListener('touchend', (e) => {
                const touchEnd = Date.now();
                const duration = touchEnd - touchStart;
                if (duration >= 300) {
                    // 长按处理（右键功能）
                    isLongPress = true;
                    if (v.classList.contains('hide')) {
                        v.classList.toggle('info');
                        message.innerHTML = `地雷：${minesCount - box.querySelectorAll('.info').length}`;
                    }
                } else {
                    // 短按处理（左键功能）
                    if (!v.classList.contains('info')) {
                        v.classList.remove('hide');
                        checkWin();
                        if (v.querySelector('.circle')) {
                            gameOver();
                        } else if (v.innerText.trim() === '') {
                            expand(v.getAttribute('data-v').split('-').map(Number));
                        } else {
                            checkNeighbors(v.getAttribute('data-v').split('-').map(Number));
                        }
                    }
                }
                e.preventDefault();
            });

            // 防止长按触发默认菜单
            v.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
        });

        // 展开空块
        function expand(indexs) {
            [
                [indexs[0] - 1, indexs[1] - 1], [indexs[0] - 1, indexs[1]], [indexs[0] - 1, indexs[1] + 1],
                [indexs[0], indexs[1] - 1],                           [indexs[0], indexs[1] + 1],
                [indexs[0] + 1, indexs[1] - 1], [indexs[0] + 1, indexs[1]], [indexs[0] + 1, indexs[1] + 1],
            ].forEach(subIndexs => {
                const el = document.querySelector(`[data-v="${subIndexs.join('-')}"]`);
                if (el && el.className.indexOf('hide') >= 0 && !el.classList.contains('info')) {
                    el.classList.remove('hide');
                    if (el.innerText.trim() === '') {
                        expand(subIndexs);
                    }
                }
            });
        }

        // 检查周围标记数量
        function checkNeighbors(indexs) {
            const neighbors = [
                [indexs[0] - 1, indexs[1] - 1],
                [indexs[0] - 1, indexs[1]],
                [indexs[0] - 1, indexs[1] + 1],
                [indexs[0], indexs[1] - 1],
                [indexs[0], indexs[1] + 1],
                [indexs[0] + 1, indexs[1] - 1],
                [indexs[0] + 1, indexs[1]],
                [indexs[0] + 1, indexs[1] + 1],
            ];
            const markedCount = neighbors.filter(([i, j]) => {
                const el = document.querySelector(`[data-v="${i}-${j}"]`);
                return el && el.classList.contains('info');
            }).length;
            const currentNumber = parseInt(v.innerText);
            if (markedCount === currentNumber) {
                neighbors.forEach(([i, j]) => {
                    const el = document.querySelector(`[data-v="${i}-${j}"]`);
                    if (el &&!el.classList.contains('info') && el.classList.contains('hide')) {
                        el.classList.remove('hide');
                        if (el.innerText.trim() === '') {
                            expand([i, j]);
                        }
                    }
                });
            }
        }

        // 检查胜利
        function checkWin() {
            if (minesCount === box.querySelectorAll('.info').length) {
                alert("你赢了！");
                clearInterval(intervalId);
            }
        }

        // 游戏结束
        function gameOver() {
            box.querySelectorAll('.item').forEach(el => {
                if (el.querySelector('.circle')) el.classList.remove('hide');
            });
            setTimeout(() => alert('你被炸死了'), 100);
            clearInterval(intervalId);
        }
    </script>
</body>

</html>
